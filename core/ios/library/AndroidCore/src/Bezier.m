//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: D:\Java\git\core-javafx-widget\SWTAndroid\src\main\stub\r\android\graphics\Bezier.java
//

#include "Bezier.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "PointF.h"
#include "java/lang/Math.h"


@interface ADBezier ()

- (void)calcLength;

- (jfloat)lineLengthWithFloat:(jfloat)x1
                    withFloat:(jfloat)y1
                    withFloat:(jfloat)x2
                    withFloat:(jfloat)y2;

/*!
 @brief Calculates the bernstein polynomial for evaluating parametric bezier
 @param numKnots - one less than number of knots in this curve hull
 @param knotNo - knot we are evaluating Bernstein for
 @param param - Parametric value we are evaluating at
 */
- (jdouble)bernsteinWithInt:(jint)numKnots
                    withInt:(jint)knotNo
                 withDouble:(jdouble)param;

- (jint)chooseWithInt:(jint)num
              withInt:(jint)denom;

@end

__attribute__((unused)) static void ADBezier_calcLength(ADBezier *self);

__attribute__((unused)) static jfloat ADBezier_lineLengthWithFloat_withFloat_withFloat_withFloat_(ADBezier *self, jfloat x1, jfloat y1, jfloat x2, jfloat y2);

__attribute__((unused)) static jdouble ADBezier_bernsteinWithInt_withInt_withDouble_(ADBezier *self, jint numKnots, jint knotNo, jdouble param);

__attribute__((unused)) static jint ADBezier_chooseWithInt_withInt_(ADBezier *self, jint num, jint denom);

@implementation ADBezier

- (instancetype)initWithFloat:(jfloat)sx
                    withFloat:(jfloat)sy
               withFloatArray:(IOSFloatArray *)coords
                      withInt:(jint)numCoords {
  ADBezier_initWithFloat_withFloat_withFloatArray_withInt_(self, sx, sy, coords, numCoords);
  return self;
}

- (void)setCoordsWithFloat:(jfloat)sx
                 withFloat:(jfloat)sy
            withFloatArray:(IOSFloatArray *)coords
                   withInt:(jint)numCoords {
  JreStrongAssignAndConsume(&coord_, [IOSFloatArray newArrayWithLength:numCoords * 2 + 2]);
  *IOSFloatArray_GetRef(coord_, 0) = sx;
  *IOSFloatArray_GetRef(coord_, 1) = sy;
  for (jint i = 0; i < numCoords; i++) {
    *IOSFloatArray_GetRef(coord_, i * 2 + 2) = IOSFloatArray_Get(nil_chk(coords), i * 2);
    *IOSFloatArray_GetRef(coord_, i * 2 + 3) = IOSFloatArray_Get(coords, i * 2 + 1);
  }
  ADBezier_calcLength(self);
}

- (jfloat)getLength {
  return length_;
}

- (void)calcLength {
  ADBezier_calcLength(self);
}

- (jfloat)lineLengthWithFloat:(jfloat)x1
                    withFloat:(jfloat)y1
                    withFloat:(jfloat)x2
                    withFloat:(jfloat)y2 {
  return ADBezier_lineLengthWithFloat_withFloat_withFloat_withFloat_(self, x1, y1, x2, y2);
}

- (ADPointF *)getFinalPointWithADPointF:(ADPointF *)point {
  ((ADPointF *) nil_chk(point))->x_ = IOSFloatArray_Get(coord_, ((IOSFloatArray *) nil_chk(coord_))->size_ - 2);
  point->y_ = IOSFloatArray_Get(coord_, coord_->size_ - 1);
  return point;
}

- (ADPointF *)evalWithDouble:(jdouble)param
                withADPointF:(ADPointF *)point {
  ((ADPointF *) nil_chk(point))->x_ = 0;
  point->y_ = 0;
  jint numKnots = JreIntDiv(((IOSFloatArray *) nil_chk(coord_))->size_, 2);
  for (jint i = 0; i < numKnots; i++) {
    jdouble scale_ = ADBezier_bernsteinWithInt_withInt_withDouble_(self, numKnots - 1, i, param);
    JrePlusAssignFloatD(&point->x_, IOSFloatArray_Get(nil_chk(coord_), i * 2) * scale_);
    JrePlusAssignFloatD(&point->y_, IOSFloatArray_Get(coord_, i * 2 + 1) * scale_);
  }
  return point;
}

- (jdouble)bernsteinWithInt:(jint)numKnots
                    withInt:(jint)knotNo
                 withDouble:(jdouble)param {
  return ADBezier_bernsteinWithInt_withInt_withDouble_(self, numKnots, knotNo, param);
}

- (jint)chooseWithInt:(jint)num
              withInt:(jint)denom {
  return ADBezier_chooseWithInt_withInt_(self, num, denom);
}

- (void)dealloc {
  RELEASE_(coord_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 1, 0, -1, -1, -1, -1 },
    { NULL, "F", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, -1, -1, -1, -1 },
    { NULL, "F", 0x2, 2, 3, -1, -1, -1, -1 },
    { NULL, "LADPointF;", 0x1, 4, 5, -1, -1, -1, -1 },
    { NULL, "LADPointF;", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "D", 0x2, 8, 9, -1, -1, -1, -1 },
    { NULL, "I", 0x2, 10, 11, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithFloat:withFloat:withFloatArray:withInt:);
  methods[1].selector = @selector(setCoordsWithFloat:withFloat:withFloatArray:withInt:);
  methods[2].selector = @selector(getLength);
  methods[3].selector = @selector(calcLength);
  methods[4].selector = @selector(lineLengthWithFloat:withFloat:withFloat:withFloat:);
  methods[5].selector = @selector(getFinalPointWithADPointF:);
  methods[6].selector = @selector(evalWithDouble:withADPointF:);
  methods[7].selector = @selector(bernsteinWithInt:withInt:withDouble:);
  methods[8].selector = @selector(chooseWithInt:withInt:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "length_", "F", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "coord_", "[F", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "FF[FI", "setCoords", "lineLength", "FFFF", "getFinalPoint", "LADPointF;", "eval", "DLADPointF;", "bernstein", "IID", "choose", "II" };
  static const J2ObjcClassInfo _ADBezier = { "Bezier", "r.android.graphics", ptrTable, methods, fields, 7, 0x1, 9, 2, -1, -1, -1, -1, -1 };
  return &_ADBezier;
}

@end

void ADBezier_initWithFloat_withFloat_withFloatArray_withInt_(ADBezier *self, jfloat sx, jfloat sy, IOSFloatArray *coords, jint numCoords) {
  NSObject_init(self);
  [self setCoordsWithFloat:sx withFloat:sy withFloatArray:coords withInt:numCoords];
}

ADBezier *new_ADBezier_initWithFloat_withFloat_withFloatArray_withInt_(jfloat sx, jfloat sy, IOSFloatArray *coords, jint numCoords) {
  J2OBJC_NEW_IMPL(ADBezier, initWithFloat_withFloat_withFloatArray_withInt_, sx, sy, coords, numCoords)
}

ADBezier *create_ADBezier_initWithFloat_withFloat_withFloatArray_withInt_(jfloat sx, jfloat sy, IOSFloatArray *coords, jint numCoords) {
  J2OBJC_CREATE_IMPL(ADBezier, initWithFloat_withFloat_withFloatArray_withInt_, sx, sy, coords, numCoords)
}

void ADBezier_calcLength(ADBezier *self) {
  self->length_ = 0;
  for (jint i = 2; i < ((IOSFloatArray *) nil_chk(self->coord_))->size_; i += 2) {
    JrePlusAssignFloatF(&self->length_, ADBezier_lineLengthWithFloat_withFloat_withFloat_withFloat_(self, IOSFloatArray_Get(self->coord_, i - 2), IOSFloatArray_Get(self->coord_, i - 1), IOSFloatArray_Get(self->coord_, i), IOSFloatArray_Get(self->coord_, i + 1)));
  }
}

jfloat ADBezier_lineLengthWithFloat_withFloat_withFloat_withFloat_(ADBezier *self, jfloat x1, jfloat y1, jfloat x2, jfloat y2) {
  jfloat dx = x2 - x1;
  jfloat dy = y2 - y1;
  return (jfloat) JavaLangMath_sqrtWithDouble_(dx * dx + dy * dy);
}

jdouble ADBezier_bernsteinWithInt_withInt_withDouble_(ADBezier *self, jint numKnots, jint knotNo, jdouble param) {
  jdouble iParam = 1 - param;
  switch (numKnots) {
    case 0:
    return 1;
    case 1:
    {
      switch (knotNo) {
        case 0:
        return iParam;
        case 1:
        return param;
      }
      break;
    }
    case 2:
    {
      switch (knotNo) {
        case 0:
        return iParam * iParam;
        case 1:
        return 2 * iParam * param;
        case 2:
        return param * param;
      }
      break;
    }
    case 3:
    {
      switch (knotNo) {
        case 0:
        return iParam * iParam * iParam;
        case 1:
        return 3 * iParam * iParam * param;
        case 2:
        return 3 * iParam * param * param;
        case 3:
        return param * param * param;
      }
      break;
    }
  }
  jdouble retVal = 1;
  for (jint i = 0; i < knotNo; i++) {
    JreTimesAssignDoubleD(&retVal, param);
  }
  for (jint i = 0; i < numKnots - knotNo; i++) {
    JreTimesAssignDoubleD(&retVal, iParam);
  }
  JreTimesAssignDoubleD(&retVal, ADBezier_chooseWithInt_withInt_(self, numKnots, knotNo));
  return retVal;
}

jint ADBezier_chooseWithInt_withInt_(ADBezier *self, jint num, jint denom) {
  jint denom2 = num - denom;
  if (denom < denom2) {
    jint tmp = denom;
    denom = denom2;
    denom2 = tmp;
  }
  jint prod = 1;
  for (jint i = num; i > denom; i--) {
    prod *= num;
  }
  for (jint i = 2; i <= denom2; i++) {
    prod /= i;
  }
  return prod;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ADBezier)
